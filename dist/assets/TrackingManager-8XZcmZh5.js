import{u as N,M as i,A as r,j as e}from"./index-DmeS5GNz.js";import{u as C,b as m}from"./vendor-7WqT3uju.js";const $=()=>{const{user:v}=N(),f=C(),[o,p]=m.useState([]),[s,d]=m.useState({id:"",platform:"google-tag-manager",code:"",position:"head",active:!0}),g=[{value:"google-tag-manager",label:"Google Tag Manager"},{value:"fb-pixel",label:"Facebook Pixel"},{value:"google-analytics",label:"Google Analytics"},{value:"twitter-pixel",label:"Twitter Pixel"},{value:"linkedin-insight",label:"LinkedIn Insight Tag"},{value:"custom",label:"Custom Code"}],u=[{value:"head",label:"Head (before </head>)"},{value:"body-start",label:"Body Start (after <body>)"},{value:"body-end",label:"Body End (before </body>)"}];m.useEffect(()=>{if(i.AutoInit(),v.role!=="admin"){f("/my-books");return}h()},[]);const h=async()=>{try{const a=await fetch(`${r}/tracking-codes`);if(!a.ok)throw new Error("Failed to fetch tracking codes");const t=await a.json();p(t)}catch(a){i.toast({html:`Error: ${a.message}`})}},c=a=>{const{name:t,value:l,type:n,checked:k}=a.target;d(w=>({...w,[t]:n==="checkbox"?k:l}))},b=async a=>{a.preventDefault();try{const t=s.id?`${r}/tracking-codes/${s.id}`:`${r}/tracking-codes`;if(!(await fetch(t,{method:s.id?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to save tracking code");await h(),i.toast({html:`Tracking code ${s.id?"updated":"added"} successfully!`}),x()}catch(t){i.toast({html:`Error: ${t.message}`})}},j=a=>{const t=o.find(l=>l.id===a);t&&(d(t),document.getElementById("tracking-form").scrollIntoView({behavior:"smooth"}))},y=async a=>{if(window.confirm("Are you sure you want to delete this tracking code?"))try{if(!(await fetch(`${r}/tracking-codes/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to delete tracking code");await h(),i.toast({html:"Tracking code deleted successfully"})}catch(t){i.toast({html:`Error: ${t.message}`})}},x=()=>{d({id:"",platform:"google-tag-manager",code:"",position:"head",active:!0})};return e.jsxs("div",{className:"container",children:[e.jsx("h3",{className:"center-align",children:"Tracking Code Manager"}),e.jsx("div",{className:"card-panel",children:e.jsxs("form",{id:"tracking-form",onSubmit:b,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"input-field col s12 m6",children:[e.jsx("select",{name:"platform",value:s.platform,onChange:c,required:!0,children:g.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("label",{children:"Platform"})]}),e.jsxs("div",{className:"input-field col s12 m6",children:[e.jsx("select",{name:"position",value:s.position,onChange:c,required:!0,children:u.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("label",{children:"Position"})]})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("textarea",{id:"code",className:"materialize-textarea",name:"code",value:s.code,onChange:c,required:!0,style:{fontFamily:"monospace",minHeight:"150px"}}),e.jsx("label",{htmlFor:"code",children:"Tracking Code"})]}),e.jsx("div",{className:"switch",children:e.jsxs("label",{children:["Inactive",e.jsx("input",{type:"checkbox",name:"active",checked:s.active,onChange:c}),e.jsx("span",{className:"lever"}),"Active"]})}),e.jsxs("div",{className:"center-align",style:{marginTop:"20px"},children:[e.jsxs("button",{type:"submit",className:"btn waves-effect waves-light blue",children:[e.jsx("i",{className:"material-icons left",children:"save"}),s.id?"Update":"Save"," Code"]}),s.id&&e.jsxs("button",{type:"button",className:"btn waves-effect waves-light grey",onClick:x,style:{marginLeft:"10px"},children:[e.jsx("i",{className:"material-icons left",children:"cancel"}),"Cancel"]})]})]})}),e.jsxs("div",{className:"card-panel",style:{marginTop:"30px"},children:[e.jsx("h5",{className:"center-align",children:"Saved Tracking Codes"}),o.length===0?e.jsx("p",{className:"center-align",children:"No tracking codes saved yet"}):e.jsxs("table",{className:"highlight responsive-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Platform"}),e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:o.map(a=>{var t,l;return e.jsxs("tr",{children:[e.jsx("td",{children:((t=g.find(n=>n.value===a.platform))==null?void 0:t.label)||a.platform}),e.jsx("td",{children:((l=u.find(n=>n.value===a.position))==null?void 0:l.label)||a.position}),e.jsx("td",{children:e.jsx("span",{className:`btn-small ${a.active?"green":"black"}`,children:a.active?"Active":"Inactive"})}),e.jsxs("td",{children:[e.jsx("button",{className:"btn-small waves-effect waves-light blue",onClick:()=>j(a.id),title:"Edit",children:e.jsx("i",{className:"material-icons",children:"edit"})}),e.jsx("button",{className:"btn-small waves-effect waves-light red",onClick:()=>y(a.id),title:"Delete",style:{marginLeft:"10px"},children:e.jsx("i",{className:"material-icons",children:"delete"})})]})]},a.id)})})]})]})]})};export{$ as default};
