import{g as p,M as g,j as e}from"./index-DmeS5GNz.js";import{b as m,h as C,f as E,L as w}from"./vendor-7WqT3uju.js";import{a as S,b as _}from"./bookService-Bs2BJIUy.js";const B=()=>{m.useEffect(()=>{const r=(s,t)=>{document.querySelectorAll(`[data-tracking="${t}"]`).forEach(c=>c.remove());const o=document.createElement("div");switch(o.setAttribute("data-tracking",t),o.innerHTML=s.map(c=>c.code).join(`
`),t){case"head":document.head.appendChild(o);break;case"body-start":document.body.insertBefore(o,document.body.firstChild);break;case"body-end":document.body.appendChild(o);break}};return(async()=>{try{const[s,t,o]=await Promise.all([p("head"),p("body-start"),p("body-end")]);if(s.length){const c=s.map(l=>l.code).join(`
`);r(s,"head")}if(t.length){const c=t.map(l=>l.code).join(`
`);r(t,"body-start")}if(o.length){const c=o.map(l=>l.code).join(`
`);r(o,"body-end")}}catch(s){console.error("Error loading tracking codes:",s)}})(),()=>{["head","body-start","body-end"].forEach(s=>{document.querySelectorAll(`[data-tracking="${s}"]`).forEach(t=>t.remove())})}},[])},x="bookEmail",f="bookEmailExpiry",T=()=>{const r=localStorage.getItem(x),h=localStorage.getItem(f);return!r||!h?null:new Date().getTime()>parseInt(h)?(localStorage.removeItem(x),localStorage.removeItem(f),null):r},R=()=>{var u;B();const r=C(),{slug:h}=E(),s=h||((u=r.state)==null?void 0:u.bookSlug),[t,o]=m.useState(null),[c,l]=m.useState(!0),[j,I]=m.useState(!!T());m.useEffect(()=>{const a=async()=>{l(!0);try{const n=await S();if(n.length>0){let i;if(s&&(i=n.find(d=>d.slug===s),i||(i=n.find(d=>y(d.title)===s)),i&&i.id&&await _(i.id)),!i){const d=n.filter(N=>N.book_status===1),k=Math.floor(Math.random()*d.length);i=d[k]}o(i)}}catch(n){console.error("Error:",n)}l(!1)};g.AutoInit(),a()},[s]),m.useEffect(()=>{if(t)return document.title=`${t.title} - Optread`,()=>{document.title="Optread"}},[t]);const b=a=>a.book_type==="free"?e.jsxs("a",{href:a.source_url,target:"_blank",className:"btn btn-large green",children:[e.jsx("i",{className:"material-icons left",children:"download"}),"Claim Your Free Copy Now!"]}):e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:a.source_url,target:"_blank",className:"btn btn-large orange",children:[e.jsx("i",{className:"material-icons left",children:"local_offer"}),"Claim Your Discounted Copy Now!"]}),e.jsxs("div",{className:"btn btn-large",style:{marginLeft:"10px"},onClick:v(a.discount_code),title:"Click to Copy Discount Code",children:[e.jsx("i",{className:"material-icons left",children:"local_offer"})," ",a.discount_code]})]});if(c)return e.jsx("div",{className:"container center-align",style:{marginTop:"50px"},children:e.jsx("div",{className:"preloader-wrapper big active",children:e.jsx("div",{className:"spinner-layer spinner-blue-only",children:e.jsx("div",{className:"circle-clipper left",children:e.jsx("div",{className:"circle"})})})})});const v=a=>()=>{navigator.clipboard.writeText(a).then(()=>{g.toast({html:"Coupon code copied to clipboard!"})}).catch(n=>{g.toast({html:"Failed to copy coupon code."})})};return e.jsx("div",{className:"container",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"center-align",children:["Read ",t.title]}),e.jsxs("div",{className:"card horizontal",style:{marginTop:"30px"},children:[e.jsx("div",{className:"card-image",style:{width:"240px",padding:"20px"},children:e.jsx("img",{src:t.cover||"https://placehold.co/240x320",alt:t.title,style:{width:"100%",height:"auto"}})}),e.jsx("div",{className:"card-stacked",children:e.jsxs("div",{className:"card-content",children:[e.jsx("h4",{children:t.title}),e.jsxs("h5",{children:["By ",t.author]}),e.jsx("div",{className:"divider",style:{margin:"15px 0"}}),t.description?t.description.split(`
`).map((a,n)=>a.trim().length>0?e.jsx("p",{children:a},n):null):e.jsx("p",{children:"No description available."}),e.jsx("div",{className:"divider",style:{margin:"15px 0"}}),b(t),t.discount_price&&t.price&&e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsxs("span",{className:"grey-text",style:{textDecoration:"line-through",marginRight:"10px"},children:["$",t.price.toFixed(2)]}),e.jsxs("span",{className:"green-text text-darken-2",style:{fontSize:"1.2em"},children:["$",t.discount_price.toFixed(2)]})]}),e.jsx("div",{className:"row",style:{marginTop:"20px"},children:e.jsxs("div",{className:"col s12",children:[e.jsx("span",{className:"chip teal white-text",children:t.category||"Uncategorized"}),t.tags&&t.tags.split(",").map(a=>e.jsx("span",{className:"chip",children:a.trim()},a))]})})]})})]})]}):e.jsxs("div",{className:"center-align",style:{marginTop:"50px"},children:[e.jsx("h4",{children:"Welcome to Our Book Collection"}),e.jsx("p",{children:"Please verify your email to access our free and discounted books."}),e.jsx(w,{to:`/book/${y(t.title)}`,className:"btn waves-effect waves-light",children:"Return"})]})})},y=r=>r.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");export{R as default};
