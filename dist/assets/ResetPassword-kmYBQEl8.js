import{j as e,M as m}from"./index-DmeS5GNz.js";import{f as y,u as b,b as a}from"./vendor-7WqT3uju.js";const S=()=>{const{token:l}=y(),j=b(),[r,w]=a.useState(""),[p,v]=a.useState(!1),[c,o]=a.useState(""),[x,u]=a.useState(null),[d,i]=a.useState(!1),[n,f]=a.useState("");a.useEffect(()=>{(async()=>{i(!0);try{const s=await fetch(`/api/auth/verify-reset-token/${l}`),h=await s.json();if(!s.ok)throw new Error(h.message||"Invalid or expired token");u(!0)}catch(s){u(!1),o(s.message),m.toast({html:s.message,classes:"red"})}finally{i(!1)}})()},[l]);const g=()=>r.length<6?(f("Password must be at least 6 characters"),!1):(f(""),!0),N=async t=>{if(t.preventDefault(),!!g()){i(!0),o("");try{const s=await fetch(`/api/auth/reset-password/${l}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:r})}),h=await s.json();if(!s.ok)throw new Error(h.message||"Failed to reset password");m.toast({html:"Password reset successfully!",classes:"green"}),j("/login")}catch(s){o(s.message),m.toast({html:`Error: ${s.message}`,classes:"red"})}finally{i(!1)}}};return x===null||d?e.jsxs("div",{className:"container center-align",children:[e.jsx("div",{className:"preloader-wrapper big active",children:e.jsxs("div",{className:"spinner-layer spinner-blue-only",children:[e.jsx("div",{className:"circle-clipper left",children:e.jsx("div",{className:"circle"})}),e.jsx("div",{className:"gap-patch",children:e.jsx("div",{className:"circle"})}),e.jsx("div",{className:"circle-clipper right",children:e.jsx("div",{className:"circle"})})]})}),e.jsx("p",{children:"Verifying token..."})]}):x?e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col s12 m6 offset-m3",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content",children:[e.jsx("span",{className:"card-title",children:"Reset Password"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"input-field",children:[e.jsx("input",{id:"password",type:p?"text":"password",value:r,onChange:t=>{w(t.target.value),g()},required:!0,minLength:"6",className:n?"invalid":""}),e.jsx("label",{htmlFor:"password",className:r?"active":"",children:"New Password (min 6 characters)"}),n&&e.jsx("span",{className:"helper-text red-text",children:n})]}),e.jsx("div",{className:"input-field",style:{marginTop:"-10px",marginBottom:"20px"},children:e.jsxs("label",{style:{userSelect:"none",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>v(t=>!t),style:{marginRight:"8px",verticalAlign:"middle"}}),e.jsx("span",{style:{verticalAlign:"middle"},children:"Show Password"})]})}),e.jsx("div",{className:"center-align",children:e.jsx("button",{className:"btn waves-effect waves-light",type:"submit",disabled:d||n,children:d?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"material-icons left",children:"refresh"}),"Resetting..."]}):"Reset Password"})}),c&&e.jsx("p",{className:"red-text center-align",children:c})]})]})})})})}):e.jsxs("div",{className:"container center-align",children:[e.jsx("h5",{children:"Invalid or Expired Token"}),e.jsx("p",{className:"red-text",children:c}),e.jsx("a",{href:"/forgot-password",className:"btn waves-effect waves-light",children:"Request New Reset Link"})]})};export{S as default};
