import{u as v,A as o,M as a,j as e}from"./index-DmeS5GNz.js";import{u as E,b as n}from"./vendor-7WqT3uju.js";const _=()=>{const{user:l}=v(),c=E(),[d,h]=n.useState([]),[u,b]=n.useState([]),[p,x]=n.useState(!0);n.useEffect(()=>{if(!l||l.role!=="admin"){c("/my-books");return}m()},[l,c]);const m=async()=>{try{const s=await fetch(`${o}/users`);if(!s.ok)throw new Error("Failed to fetch contributors");const t=await s.json();h(t.filter(k=>k.role==="contributor"));const r=await fetch(`${o}/subscribers/summary`);if(!r.ok)throw new Error("Failed to fetch subscribers");const i=await r.json();b(i)}catch(s){a.toast({html:s.message})}finally{x(!1)}},f=async s=>{if(window.confirm("Are you sure you want to delete this contributor? This action cannot be undone."))try{if(!(await fetch(`${o}/users/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete contributor");a.toast({html:"Contributor deleted successfully"}),h(d.filter(r=>r.id!==s))}catch(t){a.toast({html:t.message})}},j=async s=>{if(window.confirm("Are you sure you want to delete this subscriber? This action cannot be undone."))try{if(!(await fetch(`${o}/subscribers/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete subscriber");a.toast({html:"Subscriber deleted successfully"}),b(u.filter(r=>r.id!==s))}catch(t){a.toast({html:t.message})}},w=async(s,t)=>{try{if(!(await fetch(`${o}/users/${s}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_status:t==="paused"?"active":"paused"})})).ok)throw new Error("Failed to update user status");a.toast({html:`User ${t==="paused"?"unpaused":"paused"} successfully`}),m()}catch(r){a.toast({html:r.message})}},y=async()=>{try{const s=await fetch(`${o}/subscribers/export-all`);if(!s.ok)throw new Error("Failed to export subscribers");const t=await s.blob(),r=window.URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=`all_subscribers_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(r)}catch(s){a.toast({html:s.message})}},g=async s=>{try{if(!(await fetch(`${o}/auth/request-reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})})).ok)throw new Error("Failed to send reset password link");a.toast({html:"Reset password link sent successfully"})}catch(t){a.toast({html:t.message})}};return p?e.jsx("div",{className:"center-align",children:"Loading..."}):e.jsxs("div",{className:"container",children:[e.jsx("h4",{children:"Manage Users"}),e.jsx("h5",{children:"Contributors"}),e.jsxs("table",{className:"striped responsive-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Full Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Books Posted"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.full_name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.user_status||"active"}),e.jsx("td",{children:s.book_count}),e.jsxs("td",{children:[e.jsx("button",{className:`btn-small ${s.user_status==="paused"?"green":"orange"} waves-effect waves-light`,style:{marginRight:8},onClick:()=>w(s.id,s.user_status),title:s.user_status==="paused"?"Unpause":"Pause",children:e.jsx("i",{className:"material-icons",children:s.user_status==="paused"?"play_arrow":"pause"})}),e.jsx("button",{className:"btn-small blue waves-effect waves-light",style:{marginRight:8},onClick:()=>g(s.email),title:"Send Reset Password Link",children:e.jsx("i",{className:"material-icons",children:"lock_reset"})}),e.jsx("button",{className:"btn-small red waves-effect waves-light",onClick:()=>f(s.id),title:"Delete Contributor",children:e.jsx("i",{className:"material-icons",children:"delete"})})]})]},s.id))})]}),e.jsx("div",{style:{margin:"50px 0",borderBottom:"1px solid #ddd"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h5",{children:"Subscribers"}),e.jsxs("button",{className:"btn blue waves-effect waves-light",onClick:y,children:[e.jsx("i",{className:"material-icons left",children:"file_download"}),"Export All Subscribers"]})]}),e.jsxs("table",{className:"striped responsive-table",style:{marginTop:"20px"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{className:"tooltipped","data-position":"top","data-tooltip":"Subscribed books count",children:e.jsx("i",{className:"material-icons tiny",children:"rss_feed"})}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.book_count}),e.jsx("td",{children:e.jsx("button",{className:"btn-small red waves-effect waves-light",onClick:()=>j(s.id),title:"Delete Subscriber",children:e.jsx("i",{className:"material-icons",children:"delete"})})})]},s.id))})]})]})};export{_ as default};
