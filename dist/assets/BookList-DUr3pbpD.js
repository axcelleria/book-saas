import{u as b,M as n,A as F,j as e}from"./index-DmeS5GNz.js";import{b as c,u as L,L as d}from"./vendor-7WqT3uju.js";const E=()=>{const{user:h}=b(),u=(h==null?void 0:h.role)==="admin",[x,f]=c.useState([]),[p,m]=c.useState([]),[i,w]=c.useState({title:"",author:"",category:"",tags:""}),[a,y]=c.useState({authors:[],categories:[],tags:[]});L(),c.useEffect(()=>{n.AutoInit(),N()},[]);const N=async()=>{try{const s=await(await fetch(`${F}/books`)).json();f(s),m(s)}catch(t){n.toast({html:"Error loading books"}),console.error("Error:",t)}};c.useEffect(()=>{let t=x;i.title&&(t=t.filter(s=>s.title.toLowerCase().includes(i.title.toLowerCase()))),i.author&&(t=t.filter(s=>s.author.toLowerCase().includes(i.author.toLowerCase()))),i.category&&(t=t.filter(s=>s.category.toLowerCase().includes(i.category.toLowerCase()))),i.tags&&(t=t.filter(s=>s.tags.toLowerCase().includes(i.tags.toLowerCase()))),a.authors.length>0&&(t=t.filter(s=>a.authors.includes(s.author))),a.categories.length>0&&(t=t.filter(s=>a.categories.includes(s.category))),a.tags.length>0&&(t=t.filter(s=>a.tags.some(l=>s.tags.split(",").map(r=>r.trim()).includes(l)))),n.Tooltip.init(document.querySelectorAll(".tooltipped")),m(t)},[x,i,a]);const o=t=>{const{name:s,value:l}=t.target;w(r=>({...r,[s]:l}))},g=(t,s)=>{y(l=>{const r=[...l[t]];return r.includes(s)?l:{...l,[t]:[...r,s]}})},j=(t,s)=>{y(l=>({...l,[t]:l[t].filter(r=>r!==s)}))},C=async t=>{if(window.confirm("Are you sure you want to delete this book?"))try{if((await fetch(`http://localhost:3001/api/books/${t}`,{method:"DELETE"})).ok){const l=x.filter(r=>r.id!==t);f(l),m(l),n.toast({html:"Book deleted successfully"})}else throw new Error("Failed to delete book")}catch(s){n.toast({html:"Error deleting book"}),console.error("Error:",s)}},v=t=>t.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return e.jsxs("div",{className:"container",children:[e.jsx("h2",{className:"center-align",children:"Book Library"}),e.jsxs("div",{className:"card-panel grey lighten-4",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"input-field col s12 m3",children:[e.jsx("input",{type:"text",id:"filter-title",name:"title",value:i.title,onChange:o}),e.jsx("label",{htmlFor:"filter-title",children:"Filter by Title"})]}),e.jsxs("div",{className:"input-field col s12 m3",children:[e.jsx("input",{type:"text",id:"filter-author",name:"author",value:i.author,onChange:o}),e.jsx("label",{htmlFor:"filter-author",children:"Filter by Author"})]}),e.jsxs("div",{className:"input-field col s12 m3",children:[e.jsx("input",{type:"text",id:"filter-category",name:"category",value:i.category,onChange:o}),e.jsx("label",{htmlFor:"filter-category",children:"Filter by Category"})]}),e.jsxs("div",{className:"input-field col s12 m3",children:[e.jsx("input",{type:"text",id:"filter-tags",name:"tags",value:i.tags,onChange:o}),e.jsx("label",{htmlFor:"filter-tags",children:"Filter by Tags"})]})]}),Object.values(a).flat().length>0&&e.jsxs("div",{className:"active-filters",children:[e.jsx("h5",{children:"Active Filters:"}),a.authors.map(t=>e.jsxs("div",{className:"chip",children:[t,e.jsx("i",{className:"close material-icons",onClick:()=>j("authors",t),children:"close"})]},`author-${t}`)),a.categories.map(t=>e.jsxs("div",{className:"chip",children:[t,e.jsx("i",{className:"close material-icons",onClick:()=>j("categories",t),children:"close"})]},`category-${t}`)),a.tags.map(t=>e.jsxs("div",{className:"chip",children:[t,e.jsx("i",{className:"close material-icons",onClick:()=>j("tags",t),children:"close"})]},`tag-${t}`))]})]}),e.jsxs("table",{className:"striped responsive-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cover"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Author"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Type"}),e.jsx("th",{style:{width:"60px"},children:e.jsx("i",{className:"material-icons",children:"visibility"})}),e.jsx("th",{style:{width:"60px"},children:e.jsx("i",{className:"material-icons",children:"download"})}),u&&e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.length>0?p.map(t=>t.book_status<1?null:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(d,{to:`/book/${v(t.title)}`,children:e.jsx("img",{src:t.cover||"https://placehold.co/60x80",alt:t.title,style:{width:"60px",height:"80px",objectFit:"cover"}})})}),e.jsx("td",{children:e.jsx(d,{to:`/book/${v(t.title)}`,children:t.title})}),e.jsx("td",{children:e.jsx("a",{href:"#!",onClick:s=>{s.preventDefault(),g("authors",t.author)},className:"blue-text",children:t.author})}),e.jsx("td",{children:e.jsx("a",{href:"#!",onClick:s=>{s.preventDefault(),g("categories",t.category)},className:"blue-text",children:t.category})}),e.jsx("td",{children:t.tags.split(",").map(s=>s.trim()).filter(s=>s).map(s=>e.jsxs("a",{href:"#!",onClick:l=>{l.preventDefault(),g("tags",s)},className:"blue-text",style:{marginRight:"5px",display:"inline-block"},children:["#",s]},s))}),e.jsx("td",{children:t.view_count||0}),e.jsx("td",{children:t.download_count||0}),u&&e.jsxs("td",{children:[e.jsx(d,{to:`/edit/${t.id}`,className:"btn-small waves-effect waves-light",style:{marginRight:"5px"},children:e.jsx("i",{className:"material-icons",children:"edit"})}),e.jsx("button",{className:"btn-small red waves-effect waves-light",onClick:()=>C(t.id),children:e.jsx("i",{className:"material-icons",children:"delete"})})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"center-align",children:"No books found"})})})]}),u&&e.jsx("div",{className:"fixed-action-btn",children:e.jsx(d,{to:"/add",className:"btn-floating btn-large blue waves-effect waves-light",children:e.jsx("i",{className:"large material-icons",children:"add"})})})]})};export{E as default};
