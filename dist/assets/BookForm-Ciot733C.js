import{u as N,M as d,j as e,A as x}from"./index-DmeS5GNz.js";import{f as w,u as C,b as u}from"./vendor-7WqT3uju.js";const B=i=>(i==null?void 0:i.role)==="admin",F="https://placehold.co/240x320/teal/white?text=Book+Cover",A=i=>i.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),S=i=>{const p=i.filter(o=>!o.parent_id),h=i.filter(o=>o.parent_id);return p.map(o=>({...o,children:h.filter(s=>s.parent_id===o.id)}))},D=()=>{const{user:i}=N(),{id:p}=w(),h=C(),o=!!p,[s,g]=u.useState({id:null,user_id:(i==null?void 0:i.id)||null,title:"",slug:"",cover:"",author:"",description:"",category:"",tags:"",book_type:"free",source_url:"",discount_code:"",book_status:0,view_count:0,download_count:0,created_at:null,updated_at:null,paused_at:null}),[j,v]=u.useState([]),[y,b]=u.useState([]),[f,m]=u.useState(!1),k=async a=>{const t=a.id?`${x}/books/${a.id}`:`${x}/books`,l=await fetch(t,{method:a.id?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok){const n=await l.json();throw new Error(n.error||"Failed to save book")}return await l.json()};u.useEffect(()=>{(async()=>{m(!0);try{if(o){const n=await fetch(`${x}/books/${p}`);if(!n.ok)throw new Error("Book not found");const c=await n.json();c.tags=Array.isArray(c.tags)?c.tags.join(", "):c.tags||"",g(c)}const t=await fetch(`${x}/categories`);if(!t.ok)throw new Error("Failed to load categories");const l=await t.json();v(l),b(S(l)),setTimeout(()=>{d.AutoInit(),d.updateTextFields()},0)}catch(t){d.toast({html:`Error: ${t.message}`}),h("/my-books")}finally{m(!1)}})()},[p,o,h,i]),u.useEffect(()=>{d.updateTextFields()},[s]),u.useEffect(()=>{const a=document.querySelectorAll("select");d.FormSelect.init(a)},[j]);const r=a=>{const{name:t,value:l,type:n}=a.target;g(c=>({...c,[t]:n==="radio"&&t==="book_status"?parseInt(l):l}))},_=async a=>{a.preventDefault(),m(!0);try{const t={id:s.id,user_id:i.id,title:s.title,slug:s.slug||A(s.title),cover:s.cover,author:s.author,description:s.description,category:s.category,tags:s.tags.split(",").map(n=>n.trim()).filter(n=>n).join(", "),book_type:s.book_type,source_url:s.source_url,discount_code:s.discount_code,book_status:parseInt(s.book_status)};o||delete t.id,await k(t),d.toast({html:`Book ${o?"updated":"added"} successfully!`});let l=B(i)?"/books":"/my-books";h(l)}catch(t){d.toast({html:`Error: ${t.message}`})}finally{m(!1)}};return f?e.jsxs("div",{className:"container center-align",style:{marginTop:"50px"},children:[e.jsx("div",{className:"preloader-wrapper big active",children:e.jsxs("div",{className:"spinner-layer spinner-blue-only",children:[e.jsx("div",{className:"circle-clipper left",children:e.jsx("div",{className:"circle"})}),e.jsx("div",{className:"gap-patch",children:e.jsx("div",{className:"circle"})}),e.jsx("div",{className:"circle-clipper right",children:e.jsx("div",{className:"circle"})})]})}),e.jsx("p",{children:"Loading..."})]}):e.jsxs("div",{className:"container-fluid",style:{padding:"20px"},children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col s12",style:{marginBottom:"20px"}})}),e.jsxs("div",{className:"row",style:{display:"flex",margin:0},children:[e.jsx("div",{className:"col s6",style:{padding:"0 30px"},children:e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"input-field",children:[e.jsx("input",{id:"title",type:"text",name:"title",value:s.title,onChange:r,required:!0}),e.jsx("label",{htmlFor:"title",children:"Book Title"})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("input",{id:"cover",type:"text",name:"cover",value:s.cover,onChange:r,required:!0}),e.jsx("label",{htmlFor:"cover",children:"Book Cover URL"})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("input",{id:"author",type:"text",name:"author",value:s.author,onChange:r,required:!0}),e.jsx("label",{htmlFor:"author",children:"Author"})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("textarea",{id:"description",className:"materialize-textarea",name:"description",value:s.description,onChange:r,required:!0}),e.jsx("label",{htmlFor:"description",children:"Description"})]}),e.jsxs("div",{className:"input-field",children:[e.jsxs("select",{name:"category",value:s.category,onChange:r,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Choose a category"}),y.map(a=>e.jsx("optgroup",{label:a.name,children:a.children.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))},a.id))]}),e.jsx("label",{children:"Category"})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("input",{id:"tags",type:"text",name:"tags",value:s.tags,onChange:r}),e.jsx("label",{htmlFor:"tags",children:"Tags (comma separated)"})]}),e.jsxs("div",{style:{margin:"20px 0"},children:[e.jsx("label",{children:"Book Type:"}),e.jsx("p",{children:e.jsxs("label",{children:[e.jsx("input",{name:"book_type",type:"radio",value:"free",checked:s.book_type==="free",onChange:r}),e.jsx("span",{children:"Free Book"})]})}),e.jsx("p",{children:e.jsxs("label",{children:[e.jsx("input",{name:"book_type",type:"radio",value:"discount",checked:s.book_type==="discount",onChange:r}),e.jsx("span",{children:"Discount Book"})]})})]}),e.jsxs("div",{className:"input-field",children:[e.jsx("input",{id:"source_url",type:"url",name:"source_url",value:s.source_url,onChange:r,required:!0}),e.jsx("label",{htmlFor:"source_url",children:"Book Source URL"})]}),s.book_type==="discount"&&e.jsxs("div",{className:"input-field",children:[e.jsx("input",{id:"discount_code",type:"text",name:"discount_code",value:s.discount_code,onChange:r,required:!0}),e.jsx("label",{htmlFor:"discount_code",children:"Discount Code"})]}),e.jsxs("div",{style:{margin:"20px 0"},children:[e.jsx("label",{children:"Book Visibility:"}),e.jsx("p",{children:e.jsxs("label",{children:[e.jsx("input",{name:"book_status",type:"radio",value:"1",checked:parseInt(s.book_status)===1,onChange:r}),e.jsx("span",{children:"Public"})]})}),e.jsx("p",{children:e.jsxs("label",{children:[e.jsx("input",{name:"book_status",type:"radio",value:"0",checked:parseInt(s.book_status)===0,onChange:r}),e.jsx("span",{children:"Pending"})]})})]}),e.jsx("div",{className:"input-field",children:e.jsxs("button",{type:"submit",className:"btn waves-effect waves-light",children:[o?"Update Book":"Add Book",e.jsx("i",{className:"material-icons right",children:"send"})]})})]})}),e.jsx("div",{className:"col s6",style:{padding:"0 30px"},children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"book-preview",children:[e.jsx("div",{className:"center-align",style:{marginBottom:"20px"},children:e.jsx("img",{src:s.cover||F,alt:"Book Cover",className:"responsive-img",style:{maxHeight:"320px"}})}),s.source_url?e.jsx("a",{href:s.source_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx("h5",{children:s.title||"Book Title"})}):e.jsx("h5",{children:s.title||"Book Title"}),e.jsx("p",{className:"grey-text text-darken-2",children:s.author||"Author Name"}),s.description.split(`
`).map((a,t)=>e.jsx("p",{children:a},t))||"<p>Book description will appear here...</p>",e.jsx("div",{className:"divider",style:{margin:"15px 0"}}),s.category&&e.jsx("div",{className:"chip teal white-text",children:s.category}),s.tags&&s.tags.split(",").map((a,t)=>e.jsx("div",{className:"chip",children:a.trim()},t)),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsxs("div",{className:`chip ${parseInt(s.book_status)===1?"teal":"grey"} white-text`,children:[e.jsx("i",{className:"material-icons tiny",style:{marginRight:"10px",verticalAlign:"text-bottom"},children:parseInt(s.book_status)===1?"visibility":"visibility_off"}),parseInt(s.book_status)===1?"Public":"Paused"]}),s.book_type==="discount"&&s.discount_code&&e.jsxs("div",{className:"chip amber darken-1 white-text",children:[e.jsx("i",{className:"material-icons tiny",style:{marginRight:"10px",verticalAlign:"text-bottom"},children:"local_offer"}),s.discount_code]})]})]})})})})]})]})};export{D as default};
